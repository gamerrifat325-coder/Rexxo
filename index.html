<script>

let user={
name:localStorage.getItem("userName")||"",
dob:localStorage.getItem("userDOB")||"",
premium:localStorage.getItem("userPremium")==="true",
blocked:[]
};

if(!user.name){
user.name=prompt("Enter your Name:")||"Guest";
user.dob=prompt("Enter your Birth Date (DD/MM/YYYY):")||"";
localStorage.setItem("userName",user.name);
localStorage.setItem("userDOB",user.dob);
}

let searchHistory=JSON.parse(localStorage.getItem("searchHistory")||"[]");
let watchCount=0;
let halfWatchCount=0;

function updateProfileDisplay(){
document.getElementById("profilePic").innerText=user.name.charAt(0).toUpperCase();
document.getElementById("profileName").innerText=user.name;
}
updateProfileDisplay();

function editName(){
let newName=prompt("Enter new Name:",user.name);
if(newName){
user.name=newName;
localStorage.setItem("userName",newName);
updateProfileDisplay();
renderVideos();
}
}

function switchTab(tabId){
['homeTab','createTab','subscriptionTab','meTab'].forEach(t=>document.getElementById(t).classList.add('hidden'));
document.getElementById(tabId).classList.remove('hidden');
if(tabId==="meTab") renderYourVideos();
}

function goPremium(){switchTab('subscriptionTab');}

function showInfo(event){
event.stopPropagation();
alert("If you buy ‚Çπ200 Premium, Shorts and Bio features will be unlocked for you.");
}

function showRedeem(){
document.getElementById("redeemSection").classList.remove("hidden");
}

function submitRedeem(){
let code=document.getElementById("redeemCode").value;
if(!code){alert("Enter Redeem Code");return;}
let phone="919607903090";
let message=encodeURIComponent("Premium Redeem Request\nCode: "+code+"\nUser: "+user.name);
window.open("https://wa.me/"+phone+"?text="+message,"_blank");
alert("Redeem request sent to Admin.");
}

let videos=[
{title:"Rexxo Gameplay 1",id:"dQw4w9WgXcQ",likes:0,owner:"Admin",time:Date.now()},
{title:"Rexxo Gameplay 2",id:"9bZkp7q19f0",likes:0,owner:"Admin",time:Date.now()}
];

function timeAgo(time){
let diff=Math.floor((Date.now()-time)/3600000);
return diff<=1?"Just now":diff+" hours ago";
}

function renderVideos(list=videos){
let container=document.getElementById("videoList");
container.innerHTML="";
list.forEach((v,i)=>{
if(user.blocked.includes(v.owner)) return;

let ownerControls="";
if(v.owner===user.name){
ownerControls=`<button onclick="deleteVideo(${i})">üóë Delete</button>`;
}else{
ownerControls=`<button onclick="reportVideo()">üö© Report</button>
<button onclick="blockUser('${v.owner}')">üö´ Block</button>`;
}

container.innerHTML+=`
<div class="video-card">
<h4>${v.title}</h4>
<iframe src="https://www.youtube.com/embed/${v.id}" allowfullscreen 
onplay="watchCount++"></iframe>
<br>
<div style="display:flex;align-items:center;margin-top:5px;">
<div style="width:30px;height:30px;border-radius:50%;background:#555;
display:flex;align-items:center;justify-content:center;">
${v.owner.charAt(0).toUpperCase()}
</div>
<span style="margin-left:8px;">${v.owner} ‚Ä¢ ${timeAgo(v.time)}</span>
</div>
<br>
<button onclick="likeVideo(${i})">üëç ${v.likes}</button>
${ownerControls}
</div>`;
});
}

function likeVideo(i){videos[i].likes++;renderVideos();}
function deleteVideo(i){videos.splice(i,1);renderVideos();}

function reportVideo(){alert("Video Reported");}
function blockUser(owner){
user.blocked.push(owner);
alert(owner+" Blocked");
renderVideos();
}

function uploadCheck(){
if(!user.premium){alert("Premium Only");return;}
addVideo();
}

function addVideo(){
let title=document.getElementById("videoTitle").value;
let link=document.getElementById("videoLink").value;
let id=link.split("v=")[1]||link.split("youtu.be/")[1];
if(!title||!id){alert("Enter valid title & URL");return;}
videos.push({title,id,likes:0,owner:user.name,time:Date.now()});
renderVideos();
}

function searchVideos(){
let term=document.getElementById("searchInput").value.toLowerCase();
if(term) searchHistory.push(term);
localStorage.setItem("searchHistory",JSON.stringify(searchHistory));
renderVideos(videos.filter(v=>v.title.toLowerCase().includes(term)));
}

function renderYourVideos(){
let container=document.getElementById("meTab");
let your=videos.filter(v=>v.owner===user.name);
let html="<h3>Your Videos</h3>";
your.forEach((v,i)=>{
html+=`
<div style="background:#222;padding:8px;margin-bottom:8px;">
<b>${v.title}</b>
<button onclick="editVideo(${i})">‚úè Edit</button>
<button onclick="deleteVideo(${i})">üóë</button>
</div>`;
});
html+=`<h3>History</h3>
Searches: ${searchHistory.join(", ")}<br>
Videos Watched: ${watchCount}<br>
Half Watched: ${halfWatchCount}`;
container.innerHTML=html;
}

function editVideo(i){
let newTitle=prompt("Edit Title:",videos[i].title);
if(newTitle){videos[i].title=newTitle;renderVideos();}
}

renderVideos();

</script>
